<!DOCTYPE html>
<html lang="ko">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Files - ZiinDrive</title>
	</head>
	<body>
		<style>
			.uploadBt {
				font-size: 35px;
				padding: 2px 15px;
				text-align: center;
				background-color: darkcyan;
				border: none;
				color: white;
			}
			.sortButtonsDiv {
				display: flex;
				height: 30px;
				align-items: center;
			}
			.sortBt {
				font-size: 15px;
				background-color: white;
				color: black;
				cursor: pointer;
				transition: all 0.2s ease;
				border-width: 1px;
			}
			.sortBt.active {
				background-color: black;
				color: white;
			}
			.isEmpty {
				display: flex;
				width: 100%;
				height: 300px;
				align-items: center;
				justify-content: center;
			}
		</style>

		<!-- 사이트 로고 -->
		<div style="text-align: left; align-items: center">
			<h2>&nbsp;&nbsp;&nbsp;<b>Ziin</b>Drive</h2>
		</div>

		<span
			style="
				display: flex;
				justify-content: space-between;
				align-items: center;
				height: 70px;
			"
		>
			<!-- 이름, 날짜별 검색 등 버튼 -->
			<span>
				<label style="font-size: 15px"
					>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;제목&nbsp;&nbsp;</label
				>
				<input id="keyword" type="text" style="font-size: 15px" />

				<label style="font-size: 15px"
					>&nbsp;&nbsp;형식&nbsp;&nbsp;</label
				>
				<!--콤보박스-->
				<select id="extension" name="extension" style="font-size: 15px">
					<option value="">모든 형식</option>
					<option value="png">png</option>
					<option value="jpg">jpg</option>
					<option value="docx">docx</option>
					<option value="none">확장자 없음</option>
				</select>

				<label style="font-size: 15px"
					>&nbsp;&nbsp;날짜&nbsp;&nbsp;</label
				>
				<input id="from" type="date" />
				<label style="font-size: 15px">&nbsp;~&nbsp;</label>
				<input id="to" type="date" />

				<label style="font-size: 15px">&nbsp;&nbsp;</label>
				<button style="font-size: 16px" onclick="searchFiles()">
					검색
				</button>

				<label style="font-size: 15px">&nbsp;&nbsp;</label>
				<button
					style="font-size: 16px"
					onclick="location.href='/files'"
				>
					초기화
				</button>
			</span>

			<!-- 업로드 버튼 표시 위치 -->
			<span>
				<form id="uploadForm" enctype="multipart/form-data">
					<input
						id="fileInput"
						name="fileInput"
						type="file"
						style="display: none"
						onchange="uploadFile()"
					/>
					<button
						type="button"
						class="uploadBt"
						onclick="document.getElementById('fileInput').click()"
					>
						<b>+</b>
					</button>
					<label style="font-size: 15px">&nbsp;&nbsp;&nbsp;</label>
				</form>
			</span>
		</span>

		<!--정렬 선택 버튼-->
		<div class="sortButtonsDiv">
			<label style="font-size: 15px">
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			</label>
			<button id="latest" class="sortBt" data-sort="latest">
				최신순
			</button>
			<button id="name" class="sortBt" data-sort="name">이름순</button>
			<button id="oldest" class="sortBt" data-sort="oldest">
				오래된순
			</button>
		</div>

		<!-- 모든 파일 리스트 -->
		<div id="fileTable" th:attr="data-sort=${currentSort}">
			<table style="width: 100%; text-align: center">
				<thead>
					<tr style="height: 50px; align-items: center">
						<th style="width: 400px; color: rgb(134, 133, 133)">
							파일명
						</th>
						<th style="width: 200px; color: rgb(134, 133, 133)">
							업로드 날짜
						</th>
						<th style="width: 200px; color: rgb(134, 133, 133)">
							크기
						</th>
						<th>&nbsp;&nbsp;</th>
						<th>&nbsp;&nbsp;</th>
						<th>&nbsp;&nbsp;</th>
					</tr>
				</thead>
				<tbody th:each="file : ${fileList}">
					<tr
						th:attr="data-id=${file.id}"
						style="height: 40px; align-items: center"
					>
						<td th:text="${file.originalName}">$</td>
						<td th:text="${file.formattedDate}"></td>
						<td th:text="${file.size}"></td>
						<td>
							<button
								onclick="downloadFile(this)"
								style="
									background-color: cadetblue;
									color: white;
								"
							>
								다운로드
							</button>
						</td>
						<td>
							<button
								onclick="renameFile(this)"
								style="
									background-color: lightgray;
									color: black;
								"
							>
								이름 변경
							</button>
						</td>
						<td>
							<button
								onclick="deleteFile(this)"
								style="
									background-color: firebrick;
									color: white;
								"
							>
								삭제
							</button>
						</td>
					</tr>
				</tbody>
			</table>
		</div>

		<!-- 파일이 없을 때 -->
		<div th:if="${fileList.empty}" class="isEmpty">
			<h3>파일이 없습니다.</h3>
		</div>

		<!-- script -->
		<script src="/js/search.js"></script>
		<script src="/js/sort.js"></script>
		<script src="/js/upload.js"></script>
		<script src="/js/download.js"></script>
		<script src="/js/rename.js"></script>
		<script src="/js/delete.js"></script>

		<!--bfcache 처리-->
		<script>
			window.addEventListener("pageshow", function (event) {
				if (
					event.persisted ||
					window.performance?.navigation?.type === 2
				) {
					// 뒤로가기로 복원됐거나, bfcache로 들어옴
					location.reload(); // 강제로 새로고침
				}
			});
		</script>
	</body>
</html>
